---
layout: post
title: MySQL Architecture
subtitle: JVM도 어려웠지만 MySQL 아키텍처는 더어렵네 ㅠㅠ
categories: MySQL
tags: [DB, MySQL]
---



MySQL은 크게 MySQL 엔진 + 스토리지 엔진으로 구분

### MySQL 엔진

- 클라이언트의 접속 및 쿼리 요청 처리하는 **커넥션 핸들러**
- 요청 쿼리를 토큰으로 분리해 MySQL이 인식할 수 있는 트리 구조로 만들어 기본 문법 오류를 발견하는 **MySQL parser**
- 쿼리 문장에 구조적인 문제점이 있는지 확인하고, 객체의 존재여부나 접근권한을 확인하는 **전처리기**
- 쿼리의 최적화된 실행을 위한 **옵티마이저**

크게 구분되어 있다

### 스토리지 엔진

- 실제 데이터를 디스크 스토리지에 저장
- 디스크 스토리지에 데이터를 읽기

로 되어있다

MYSQL 엔진은 하나지만 스토리지 엔진은 여러 개 이기 때문에 여러 개의 읽기 작업이나 변경 작업이 가능해진다.

그리고 스토리지 엔진은 2가지가 있다

- InnoDB
- MyISAM

각 성능에 향상에 이점을 받을 수 있도록 2개의 스토리지 엔진을 내장하고 있다.

### 핸들러 API

MySQL 엔진의 쿼리 실행기에서 데이터 쓰기/읽기 할 때 스토리지 엔진에 요청하는 것

InnoDB 스토리지 엔진과 핸들러 API를 이용해 MySQL 엔진과 데이터를 주고 받는데 얼마나 많은 작업이 있었는지 확인 방법은 

`SHOW GLOBAL STATUS LIKE 'Handler%'`

확인하면 된다.

# MYSQL 스레딩

MySQL 서버는 ?

프로세스 기반 (X) 스레드 기반(O) 

스레드는 크게 포그라운드, 백그라운드로 구분한다.

`select * from performance_schema.threads`

명령어로 데이터베이스의 threads를 확인 할 수 있다.

## 포크라운드 스레드

MySQL 서버에 접속된 클라이언트 수만큼 존재하는데 주로 각 클라이언트가 요청하는 쿼리 문장을 처리해준다.

클라이언트가 작업이 완료하면 커넥션을 종료하고 해당 스레드는 스레드 캐시에 되돌아간다.

하지만 캐시 스레드의 갯수도 제한이 있다 

만약 캐시 스레드가 꽉 차있으면 스레드 캐시에 넣지않고 스레드를 종료시킨다.

스레드 캐시를 조절 할 수 있는데 `thread_cache_size` 를 조절하면 그만큼만 캐쉬를 넣을 수 있다.

포크라운드 스레드는 데이터를 MySQL의 데이터 버퍼나 캐시로부터 가져오며 버퍼나 캐시가 없을 경우에는 직접 디스크 데이터나 인덱스 파일로 데이터를 읽어와서 작업을 처리 한다.

MyISAM이 포그라운드 쓰레드가 디스크 쓰기까지의 작업을 처리하고 InnoDB는 데이터 버퍼나 캐시까지만 포그라운드 스레드가 처리하고 

나머지 버퍼는 디스크까지 기록하는 작업은 백그라운드 스레드가 처리한다.
