---
layout: post
title: 스프링 클라우드랑 만나다
subtitle: 모놀리틱에서 왜 MSA로 넘어갈까?
categories: MSA
tags: [MSA, Spring]
---

새로운 아키텍처를 구현하는 일은 애플리케이션 확장성, 서비스 디스커버리, 모니터링, 분산 추적, 보안 관리 등 난관이 너무 많다…

해당 문제들을 해결하는 방법과 MSA의 고려할 때 감안해야하는 장단점등 알려준다.

이번에 MSA 접목 기술들을 이용하여 구축하는 방법을 알아보려고 한다.

## 마이크로 서비스 아키텍처 진화

소프트웨어 아키텍처는 구성 요소 간 구조, 동작 상호 작용을 하는 모든 기초 부분으로 관련되어있다. 

아키텍처의 차이점을 보자

### N- 계층 아키텍처

UI, 서비스, 데이터, 테스팅 등 고유 책임과 기능이 있는 여러 계층으로 나눈다 

예를 들면 UI 프로젝트가 끝나면 데이터를 만들고 만든 것들을 결합하면 전체 애플리케이션을 가질 수 있다.

### 모놀리스 아키텍처

대부분 MSA가 대중적으로 뜨기 전에는 모놀리스 아키텍처 구조로 많이 구축을 했다. 모든 UI 비지니스 및 데이터베이스 액세스 로직 함께 고유한 애플리케이션으로 패키징되어 서버에 배포된다.

![Untitled](/assets/images/msa_1_image.png)

애플리케이션은 단일 작업 단위로 배포 될 수 있지만 한 어플리케이션에서 여러 개발 팀이 작업하는 경우가 많다.

각 개발 팀은 일반적으로 특정 고객을 대상으로 하는 애플리케이션의 개별 부분 담당하고 있다.

한편 애플리케이션의 크기가 커지고 복잡성이 증가하면 모놀리스를 관리하는 것은 어려울 수도있다. 모놀리스 변경 시 다른 부분까지 영향이 갈 수도 있고 운영 환경의 시스템에서는 더 많은 시간 비용이 소모된다.

### 마이크로서비스

대규모 애플리케이션을 책임이 명확하고 관리하기 쉬운 구성 요소로 분해할 수 있다. 잘 정의된 작은 조각으로 분해해서 대규모 코드베이스에서 발생하는 전통적은 복잡성을 해결 했다.

마이크로서비스 핵심은 분해와 분리다.

![Untitled](/assets/images/msa_2_image.png)

각 팀이 어떻게 그들의 서비스 코드와 서비스 인프라스트럭처를 완전히 소유하는지 보여준다. 각 구성 요소들을 작은 책임 영역을 담당하고 서로 독립적으로 배포를 진행한다.

또 다양한 언어와 기술로도 구현이 가능하며 명확한 책임 영역을 부여할 수 있어서 하나의 목표를 향해 일하더라도 각 팀은 그들의 작업하는 서비스에만 책임질 수 있게된다.

**마이크로 서비스의 이점은?**

- 작은 책임 영역으로 배포되고 있어 새로운 기능이 더 빠르게 개발 될 수 있다.
- 트랜잭션양을 처리 할 때 많은 서버를 신고하고 매끄럽게 확장하고 축소가 가능하다.
- 애플리케이션이 한 부분만 고장나기 때문에 회복성이 매우 높다.

**→ 유연하고, 회복성이 빠르고, 확장성이좋다.**

## 스프링 마이크로 서비스

현재 스프링은 의존성 주입이라는 핵심 개념의 기반이 되는데 이로 인해서 하드코딩 대신에 어노테이션으로 외부화가 가능해지며 대규모 자바 프로젝트를 효율적으로 관리 할 수 있다.

### 스프링 부트가 마이크로서비스에 대한 이점

- 개발 시간 단축과 효율성 생산성 향상
- 웹 어플리케이션 실행을 위한 내장형 HTTP 서버 제공
- 많은 상용구코드 작성 회피
- 스프링 데이터, 시큐리티, 클라우드 같은 생테계와 통합
- 다양한 개발 플러그인 제공

## 클라우드 컴퓨팅?

유연하고 안전하면서 사용하기 쉬운 환경을 제공하는 가상화된 IT 서비스(DB, network, software, server 등) 이며 이러한 모델은 XaaS 같은 약어로 알려져 있다

- laaS : 공급업체는 서버, 스토리지, 네트워크 같은 컴퓨팅 자원에 접근할 수 있는 인프라스트럭처를 유지와 애플리케이션 확장성에 책임진다. ex) AWS(EC2), GCE(Google Compute Engine), Azure, Kubernetes
- CaaS : laaS와 PaaS의 중간 모델, 컨테이너 기반 가상화의 한 형태다. 도커처럼 경량의 이식성 높은 가상 컨테이너가 내 마이크로서비스를 클라우드 공급자 환경에 배포할 수 있다. ex) GKE, ECS
- PaaS: 사용자가 애플리케이션의 개발 실행 유지 관리에 집중할 수 있는 플랫폼과 환경을 제공해준다. Google App engine, Cloud Foundry, Heroku
- FaaS: 서버리스 아키텍처라고 하는데 서버 없이 특정 코드를 실행하는 것을 의미하지 않는다. 공급업체가 필요한 모든 서버를 제공하는 클라우드 환경에서 기능의 실행 방법을 의미한다. ex) AWS(Lambda), Google Cloud Function
- SaaS: 애플리케이션, 데이터, 운영체제 등 모든 것을 서비스 제공자가 관리한다. ex)  Salesforce Google Business

### 클라우드와 마이크로서비스?

마이크로서비스 아키텍처의 핵심 개념 중 하나는 각 서비스가 분리되어 독립적인 산출물로 패키징되어 배포 되는 것이다.

마이크로서비스를 작성할 때 서비스를 다음 중 어떤 형태로 배포할지 결정해야한다.

1. 물리 서버: 마이크로서비스는 물리 서버에 구축하고 배포할 수 있지만 서버가 제한되어 신속하게 늘릴 수 가 없고 비용이 크다.
2. 가상 머신 이미지: 마이크로서비스의 주요 이점 중 하나는 확장성과 서비스 실패 이벤트에 대한 응답으로 인스턴스를 빠르게 시작하고 종료할 수 있는데 가상 머신은 클라우드의 필수라고 할 수 있다.
3. 가상 컨테이너는 마이크로서비스가 VM 이미지에 배포하는 것은 자연스러운 확장이고 많은 개발자는 VM 대신 도커 컨테이너로 클라우드에 배포한다. 가상 컨테이너는 VM 내 실행되고 가상 컨테이너를 사용하여 하나의 VM을 동일 이미지를 공유하는 일련의 독립형 프로세스로 분리할 수 있다.

## 마이크로서비스의 코드작성?

마이크로서비스를 구축할려면 몇가지의 고려성이 존재한다.

1. 작정 규모: 서비스가 한 가지 책임 영역에 집중되도록 하려면 어떻게?
2. 위치 투명성: 서비스 클라이언트에 영향을 주지 않고 서비스 인스턴스를 추가하고 삭제하려면 물리적 위치를 어떻게 관리?
3. 회복성: 서비스에 문제가 있을 때 서비스 클라이언트가 빠르게 실패하려면 어떻게 해야 하는지?
4. 반복성: 새로운 서비스가 시작할 때마다 항상 기존과 동일한 코드와 구성을 갖게 하려면 어떻게 해야는지?
5. 확장성: 서비스 간 종속성을 최소화하면서 애플리케이션을 신속히 확장하려면 어떻게 해야는지?

해당 방법들을 고려하여 해결할 수 있는 패턴들이 존재한다.